<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APAC Finance Leadership - Ask Me Anything (AMA)</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #ffffff;
            color: #333333;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        .card {
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            overflow: hidden;
            border: 1px solid #eaeaea;
        }
        .btn-primary {
            background-color: #e31837;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-primary:hover {
            background-color: #c01530;
        }
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333333;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        .btn-danger {
            background-color: #b91c1c;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-danger:hover {
            background-color: #991b1b;
        }
        .btn-success {
            background-color: #1b7e1e;
            color: white;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
            border: none;
        }
        .btn-success:hover {
            background-color: #166118;
        }
        .form-input, .form-select, .form-textarea {
            background-color: #f9f9f9;
            color: #333333;
            border: 1px solid #dddddd;
            border-radius: 4px;
            padding: 8px 12px;
            width: 100%;
            margin-bottom: 16px;
        }
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #333333;
        }
        .badge {
            background-color: #f0f0f0;
            color: #333333;
            border-radius: 20px;
            padding: 4px 10px;
            font-size: 0.8rem;
            display: inline-block;
            margin-right: 6px;
        }
        .badge-benefits { background-color: #4CAF50; color: white; }
        .badge-compensation { background-color: #2196F3; color: white; }
        .badge-strategy { background-color: #9C27B0; color: white; }
        .badge-others { background-color: #FF9800; color: white; }
        .upvote-btn {
            background-color: transparent;
            border: none;
            color: #555555;
            cursor: pointer;
            transition: color 0.3s;
        }
        .upvote-btn:hover {
            color: #e31837;
        }
        .upvoted {
            color: #e31837;
        }
        .admin-controls {
            display: none;
        }
        .logo-container {
            max-width: 220px; /* Enlarged logo container */
            margin-right: 20px;
        }
        .tab-active {
            border-bottom: 3px solid #e31837;
            font-weight: 600;
            color: #e31837;
        }
        .question-card {
            transition: transform 0.3s;
        }
        .question-card:hover {
            transform: translateY(-3px);
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        .modal-content {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            color: #333333;
        }
        .ch-red {
            color: #e31837;
        }
        .bg-ch-red {
            background-color: #e31837;
        }
        .timestamp {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 4px;
        }
        .update-card {
            border-left: 3px solid #e31837;
            padding-left: 16px;
            margin-bottom: 24px;
        }
        .update-content {
            white-space: pre-line;
        }
        .info-box {
            background-color: #e6f2ff;
            border-left: 4px solid #4299e1;
            padding: 12px 16px;
            margin-bottom: 16px;
            color: #333333;
        }
        .warning-box {
            background-color: #fff8e6;
            border-left: 4px solid #ed8936;
            padding: 12px 16px;
            margin-bottom: 16px;
            color: #333333;
        }
        .success-box {
            background-color: #e6ffed;
            border-left: 4px solid #48bb78;
            padding: 12px 16px;
            margin-bottom: 16px;
            color: #333333;
        }
        .error-box {
            background-color: #ffebee;
            border-left: 4px solid #f56565;
            padding: 12px 16px;
            margin-bottom: 16px;
            color: #333333;
        }
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 24px;
            height: 24px;
            background-color: #e31837;
            color: white;
            border-radius: 50%;
            font-weight: bold;
            margin-right: 8px;
        }
        code {
            background-color: #f0f0f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            color: #333333;
        }
        .email-preview {
            background-color: #f5f5f5;
            color: #333;
            border-radius: 4px;
            padding: 12px;
            font-family: Arial, sans-serif;
            margin-bottom: 16px;
        }
        .email-preview-header {
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        .hidden-form {
            display: none;
        }
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(227, 24, 55, 0.3);
            border-radius: 50%;
            border-top-color: #e31837;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Dark accents for key UI elements */
        .navbar {
            background-color: #333333;
            color: white;
        }
        .navbar a {
            color: white;
        }
        .accordion-header {
            background-color: #f0f0f0;
            color: #333333;
        }
        .accordion-content {
            background-color: #ffffff;
            color: #333333;
        }
        /* For admin panel sections */
        .admin-panel-card {
            background-color: #f9f9f9;
            border: 1px solid #eaeaea;
        }
        /* Firebase status indicator */
        .connection-status {
            position: fixed;
            bottom: 10px;
            left: 10px;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 100;
        }
        .status-connected {
            background-color: #e6ffed;
            color: #1b7e1e;
            border: 1px solid #1b7e1e;
        }
        .status-disconnected {
            background-color: #ffebee;
            color: #b91c1c;
            border: 1px solid #b91c1c;
        }
        /* Firebase configuration highlight */
        .config-highlight {
            background-color: #FFFACD;
            padding: 12px;
            border: 2px dashed #e31837;
            margin: 10px 0;
            border-radius: 6px;
        }
        /* Setup instructions modal */
        .setup-instructions {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .setup-step {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e9ecef;
        }
        .setup-step:last-child {
            border-bottom: none;
        }
        .setup-screenshot {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
            max-width: 100%;
        }
        /* Pulse animation for real-time updates */
        @keyframes pulse-animation {
            0% { box-shadow: 0 0 0 0 rgba(227, 24, 55, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(227, 24, 55, 0); }
            100% { box-shadow: 0 0 0 0 rgba(227, 24, 55, 0); }
        }
        .pulse {
            animation: pulse-animation 1.5s cubic-bezier(0.455, 0.03, 0.515, 0.955) forwards;
        }
        /* GitHub Pages specific styles */
        .github-box {
            background-color: #f6f8fa;
            border: 1px solid #d0d7de;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 16px;
        }
        .github-header {
            font-weight: bold;
            color: #24292f;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container py-6">
        <!-- Header with Logo -->
        <div class="flex flex-col md:flex-row items-center mb-8">
            <div class="logo-container">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/C._H._Robinson_logo.svg/1280px-C._H._Robinson_logo.svg.png" alt="CH Robinson Logo" class="w-full">
            </div>
            <div class="text-center md:text-left mt-4 md:mt-0">
                <h1 class="text-3xl font-bold text-gray-800">APAC Finance Leadership - Ask Me Anything (AMA)</h1>
            </div>
            <div class="ml-auto mt-4 md:mt-0">
                <button id="adminLoginBtn" class="btn-secondary"><i class="fas fa-lock mr-2"></i>Admin Login</button>
                <button id="adminLogoutBtn" class="btn-secondary" style="display: none;"><i class="fas fa-sign-out-alt mr-2"></i>Logout</button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="flex border-b border-gray-300 mb-6 overflow-x-auto">
            <button id="tabAllQuestions" class="px-4 py-2 text-lg tab-active">All Questions</button>
            <button id="tabLeadershipUpdates" class="px-4 py-2 text-lg">Leadership Updates</button>
            <button id="tabSubmitQuestion" class="px-4 py-2 text-lg">Submit a Question</button>
            <div id="adminTabs" style="display: none;">
                <button id="tabAdminPanel" class="px-4 py-2 text-lg">Admin Panel</button>
            </div>
        </div>

        <!-- Search and Filter Bar -->
        <div id="searchFilterBar" class="mb-6 flex flex-col md:flex-row items-center">
            <div class="w-full md:w-1/2 mb-4 md:mb-0">
                <input type="text" id="searchInput" placeholder="Search questions..." class="form-input">
            </div>
            <div class="w-full md:w-1/2 md:pl-4 flex">
                <div class="w-full">
                    <select id="topicFilter" class="form-select">
                        <option value="all">All Topics</option>
                        <option value="benefits">Employee Benefits</option>
                        <option value="compensation">Compensation</option>
                        <option value="strategy">Strategy & Direction</option>
                        <option value="others">Others</option>
                    </select>
                </div>
                <div class="ml-2">
                    <select id="sortFilter" class="form-select">
                        <option value="latest">Latest</option>
                        <option value="popular">Most Upvoted</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Questions List Container -->
        <div id="questionsContainer" class="mb-8">
            <!-- Questions will be populated here by JavaScript -->
            <div class="text-center py-16">
                <i class="fas fa-spinner fa-spin text-4xl mb-4 ch-red"></i>
                <p>Loading questions...</p>
            </div>
        </div>

        <!-- Leadership Updates Container -->
        <div id="leadershipUpdatesContainer" class="mb-8" style="display: none;">
            <div class="card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold">Leadership Updates</h2>
                    <button id="addUpdateBtn" class="btn-primary admin-controls" style="display: none;">
                        <i class="fas fa-plus mr-2"></i>Add Update
                    </button>
                </div>
                
                <div id="updatesContent" class="space-y-6">
                    <!-- Updates will be populated here by JavaScript -->
                    <div class="text-center py-8">
                        <i class="fas fa-info-circle text-4xl mb-4 text-gray-500"></i>
                        <p class="text-gray-600">No updates available yet.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Submit Question Form - Initially Hidden -->
        <div id="submitQuestionForm" class="card p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4">Submit Your Question</h2>
            <form id="questionForm">
                <div class="mb-4">
                    <label class="form-label" for="questionTitle">Question Title</label>
                    <input type="text" id="questionTitle" class="form-input" placeholder="Brief title of your question" required>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="questionContent">Question Details</label>
                    <textarea id="questionContent" class="form-textarea" rows="4" placeholder="Provide details about your question..." required></textarea>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="questionTopic">Topic</label>
                    <select id="questionTopic" class="form-select" required>
                        <option value="">-- Select a Topic --</option>
                        <option value="benefits">Employee Benefits</option>
                        <option value="compensation">Compensation</option>
                        <option value="strategy">Strategy & Direction</option>
                        <option value="others">Others</option>
                    </select>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="submitterName">Your Name (Optional)</label>
                    <input type="text" id="submitterName" class="form-input" placeholder="Leave blank to remain anonymous">
                    <p class="text-sm text-gray-600 mt-1">If left blank, your question will be posted anonymously.</p>
                </div>
                
                <div class="mb-4">
                    <label class="form-label" for="submitterEmail">Your Email (Optional)</label>
                    <input type="email" id="submitterEmail" class="form-input" placeholder="For notification when answered (not displayed publicly)">
                    <p class="text-sm text-gray-600 mt-1">We'll notify you when your question is answered. Your email will not be shared.</p>
                </div>
                
                <div class="flex justify-end">
                    <button type="submit" id="submitQuestionBtn" class="btn-primary">
                        <i class="fas fa-paper-plane mr-2"></i>Submit Question
                    </button>
                </div>
            </form>
        </div>

        <!-- Admin Panel - Initially Hidden -->
        <div id="adminPanel" class="card p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4">Admin Panel</h2>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Pending Questions</h3>
                <div id="pendingQuestionsContainer" class="space-y-4">
                    <!-- Pending questions will be populated here -->
                    <p class="text-gray-600">No pending questions.</p>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Email Notification Settings</h3>
                <div class="card p-4 admin-panel-card mb-4">
                    <div class="success-box mb-4">
                        <h4 class="font-bold mb-2"><i class="fas fa-check-circle mr-2"></i>Email Notifications Configured</h4>
                        <p>Email notifications are set up to notify:</p>
                        <ul class="list-disc ml-6 mt-2">
                            <li><strong>Admin (<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="204a414d45530e4e454f604348524f42494e534f4e0e434f4d">[email&#160;protected]</a>)</strong> when new questions are submitted</li>
                            <li><strong>Employees</strong> when their questions receive answers (if they provided an email)</li>
                        </ul>
                    </div>
                    
                    <p class="mb-2">The system uses a built-in form submission service that works on any hosting platform.</p>
                    
                    <div class="flex mb-4">
                        <button id="testEmailBtn" class="btn-primary mr-2">
                            <i class="fas fa-paper-plane mr-1"></i> Test Email System
                        </button>
                        <button id="viewEmailPreviewBtn" class="btn-secondary">
                            <i class="fas fa-eye mr-1"></i> View Email Preview
                        </button>
                    </div>
                    
                    <div id="emailStatusIndicator" class="info-box">
                        <p><i class="fas fa-info-circle mr-2"></i>Email system status: <span id="emailStatus">Ready</span></p>
                    </div>
                </div>
                
                <div class="card p-4 admin-panel-card">
                    <h4 class="font-bold mb-3">Email Troubleshooting</h4>
                    
                    <div class="accordion">
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded">
                                <span class="font-semibold">If Email Notifications Aren't Working</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <p class="mb-3">If the automatic email system isn't working, here are some troubleshooting steps:</p>
                                
                                <div class="mb-3">
                                    <span class="step-number">1</span>
                                    <span>Test connectivity by clicking the "Test Email System" button above</span>
                                </div>
                                
                                <div class="mb-3">
                                    <span class="step-number">2</span>
                                    <span>Check if your network blocks outgoing form submissions</span>
                                </div>
                                
                                <div class="mb-3">
                                    <span class="step-number">3</span>
                                    <span>Verify the admin email is correct (currently: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="482229252d3b66262d27082b203a272a21263b2726662b2725">[email&#160;protected]</a>)</span>
                                </div>
                                
                                <div class="warning-box mt-4">
                                    <h5 class="font-bold mb-2">Limitations</h5>
                                    <p>The email system has a limit of around 50 emails per day with the free service we're using.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded">
                                <span class="font-semibold">How The Email System Works</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <p class="mb-3">This system uses a method that works without requiring account setup or creating draft emails:</p>
                                
                                <div class="mb-3">
                                    <span class="step-number">1</span>
                                    <span>When a form is submitted, data is sent to a specialized form processing service</span>
                                </div>
                                
                                <div class="mb-3">
                                    <span class="step-number">2</span>
                                    <span>The service processes the request and sends an email to the designated address</span>
                                </div>
                                
                                <div class="mb-3">
                                    <span class="step-number">3</span>
                                    <span>No client-side email applications are opened during this process</span>
                                </div>
                                
                                <div class="info-box mt-4">
                                    <h5 class="font-bold mb-2">Technical Details</h5>
                                    <p>The system uses AJAX requests to process form submissions and delivers emails without page redirects or popups.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded">
                                <span class="font-semibold">Manual Email Alternative</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <p class="mb-3">If all automatic methods fail, you can use the traditional email client approach:</p>
                                
                                <div class="mb-3">
                                    <a href="#" id="manualAdminEmailLink" class="text-blue-600 underline">
                                        <i class="fas fa-envelope mr-1"></i> Send notification to admin manually
                                    </a>
                                </div>
                                
                                <div class="mb-3">
                                    <a href="#" id="manualEmployeeEmailLink" class="text-blue-600 underline">
                                        <i class="fas fa-envelope mr-1"></i> Send notification to employee manually
                                    </a>
                                </div>
                                
                                <p class="text-sm text-gray-600 mt-3">Note: These links will open your default email application.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Admin Security</h3>
                <div class="card p-4 admin-panel-card">
                    <div class="mb-4">
                        <label class="form-label" for="adminPassword">Change Admin Password</label>
                        <input type="password" id="adminPassword" class="form-input" placeholder="Enter new admin password">
                    </div>
                    
                    <button id="saveAdminPassword" class="btn-primary">Update Password</button>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Firebase Database Status</h3>
                <div class="card p-4 admin-panel-card">
                    <div id="databaseStatusBox" class="success-box mb-4">
                        <h4 class="font-bold mb-2"><i class="fas fa-check-circle mr-2"></i>Firebase Database Connected</h4>
                        <p>The real-time database is connected and working properly.</p>
                    </div>
                    
                    <div class="info-box">
                        <h5 class="font-bold mb-2">About Shared Database</h5>
                        <p>The AMA portal uses Firebase Realtime Database to ensure all users see the same content:</p>
                        <ul class="list-disc ml-6 mt-2">
                            <li>Questions and responses are synchronized across all devices</li>
                            <li>Leadership updates appear for all users simultaneously</li>
                            <li>Upvotes are tracked globally</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="mb-6">
                <h3 class="text-xl font-semibold mb-2">Firebase Setup Instructions</h3>
                <div class="card p-4 admin-panel-card">
                    <div class="warning-box mb-4">
                        <h4 class="font-bold mb-2"><i class="fas fa-exclamation-triangle mr-2"></i>Important: Firebase Configuration Required</h4>
                        <p>Before deploying this to GitHub Pages, you need to replace the Firebase configuration with your own.</p>
                    </div>

                    <div class="accordion">
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded bg-blue-50">
                                <span class="font-semibold">Step 1: Create a Firebase Account & Project</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">1</span>Go to <a href="https://firebase.google.com/" target="_blank" class="text-blue-600 underline">firebase.google.com</a> and sign in with a Google account</p>
                                    <img src="https://cdn.jsdelivr.net/gh/firebase/firebase-js-sdk@master/packages/storage/src/implementation/imgs/firebase-logo.png" alt="Firebase Logo" class="h-8 my-2">
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">2</span>Click "Go to console" in the top right</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">3</span>Click "Add project" to create a new Firebase project</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">4</span>Enter a project name (e.g., "APAC Finance AMA")</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">5</span>Optional: Disable Google Analytics (not needed for this project)</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">6</span>Click "Create project" and wait for it to be ready</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded bg-blue-50">
                                <span class="font-semibold">Step 2: Set Up Realtime Database</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">1</span>In the Firebase console, click "Build" in the left sidebar</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">2</span>Select "Realtime Database"</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">3</span>Click "Create Database"</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">4</span>Select a location closest to your users (e.g., "asia-southeast1" for APAC)</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">5</span>Start in "test mode" for simplicity (we'll set rules later)</p>
                                    <div class="info-box">
                                        <p class="text-sm">Test mode allows read/write access without authentication - good for initial setup</p>
                                    </div>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">6</span>Click "Enable" to create the database</p>
                                </div>
                                
                                <div class="info-box mt-4">
                                    <h5 class="font-bold mb-2">Important for Security</h5>
                                    <p>For a production environment, you should eventually update the database rules for better security. But test mode is fine for initial setup.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded bg-blue-50">
                                <span class="font-semibold">Step 3: Register Your Web App</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">1</span>From your project overview page, click the web icon (&lt;/&gt;)</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">2</span>Give your app a nickname (e.g., "APAC Finance AMA")</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">3</span>Optionally register Firebase Hosting (not required for GitHub Pages)</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">4</span>Click "Register app"</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">5</span>You'll now see your Firebase configuration - this is what you need!</p>
                                    <div class="github-box">
                                        <pre class="text-sm overflow-x-auto"><code>const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "your-project-id.firebaseapp.com",
  databaseURL: "https://your-project-id.firebaseio.com",
  projectId: "your-project-id",
  storageBucket: "your-project-id.appspot.com",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};</code></pre>
                                    </div>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">6</span>Copy this entire configuration object</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded bg-blue-50">
                                <span class="font-semibold">Step 4: Update This HTML File</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">1</span>In this HTML file, search for "Firebase configuration"</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">2</span>Replace the existing firebaseConfig object with your copied configuration</p>
                                    <div class="warning-box">
                                        <p class="font-semibold">Look for this section:</p>
                                        <pre class="text-sm mt-2 overflow-x-auto"><code>// Firebase configuration
const firebaseConfig = {
    apiKey: "AIzaSyBFG6Jg7_rN5XdF_OTTmhvx8jCO_nt4JZk",
    authDomain: "apac-finance-ama.firebaseapp.com",
    databaseURL: "https://apac-finance-ama-default-rtdb.firebaseio.com",
    projectId: "apac-finance-ama",
    storageBucket: "apac-finance-ama.appspot.com",
    messagingSenderId: "598996710830",
    appId: "1:598996710830:web:7cbe0b73d36ffd09bc7c3d"
};</code></pre>
                                    </div>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">3</span>Save the HTML file after making this change</p>
                                </div>

                                <div class="info-box mt-4">
                                    <h5 class="font-bold mb-2">Note on API Keys</h5>
                                    <p>It's okay for Firebase API keys to be visible in your code. They only identify your project and are restricted by Firebase security rules.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded bg-blue-50">
                                <span class="font-semibold">Step 5: Deploy to GitHub Pages</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">1</span>Create a GitHub account if you don't have one</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">2</span>Create a new repository for your AMA portal</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">3</span>Upload this HTML file to your repository (rename it to "index.html")</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">4</span>Go to repository Settings > Pages</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">5</span>Under "Source", select the branch where your file is located (usually "main")</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">6</span>Click "Save" and wait for GitHub to provide your site URL</p>
                                </div>

                                <div class="github-box mt-4">
                                    <div class="github-header">Additional CORS Configuration</div>
                                    <p class="mb-2">For GitHub Pages to work with Firebase, you need to add your GitHub Pages domain to Firebase authorized domains:</p>
                                    <ol class="list-decimal ml-6 mt-2">
                                        <li>In Firebase console, go to Authentication</li>
                                        <li>Click on "Settings" tab</li>
                                        <li>Scroll to "Authorized domains"</li>
                                        <li>Add your GitHub Pages domain (yourname.github.io)</li>
                                        <li>Click "Add domain"</li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item mb-3">
                            <div class="accordion-header cursor-pointer flex items-center justify-between p-3 rounded bg-blue-50">
                                <span class="font-semibold">Step 6: Verify Everything Works</span>
                                <i class="fas fa-chevron-down"></i>
                            </div>
                            <div class="accordion-content hidden p-3 rounded-b">
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">1</span>Visit your GitHub Pages URL</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">2</span>Check the database connection status (bottom left corner)</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">3</span>Try submitting a test question</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">4</span>Open the site in another browser or device to verify questions appear there too</p>
                                </div>
                                
                                <div class="setup-step">
                                    <p class="mb-2"><span class="step-number">5</span>Log in as admin (default password: admin123) and try responding to a question</p>
                                </div>
                                
                                <div class="success-box mt-4">
                                    <h5 class="font-bold mb-2"><i class="fas fa-check-circle mr-2"></i>Congratulations!</h5>
                                    <p>Your APAC Finance Leadership AMA Portal is now live with real-time cross-browser synchronization!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal for Admin Login -->
        <div id="adminLoginModal" class="modal">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Admin Login</h2>
                <form id="adminLoginForm">
                    <div class="mb-4">
                        <label class="form-label" for="adminLoginPassword">Password</label>
                        <input type="password" id="adminLoginPassword" class="form-input" placeholder="Enter admin password" required>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="button" class="btn-secondary mr-2" id="cancelAdminLogin">Cancel</button>
                        <button type="submit" class="btn-primary">Login</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal for Responding to Questions -->
        <div id="responseModal" class="modal">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Respond to Question</h2>
                <div id="responseQuestionDetails" class="mb-4 pb-4 border-b border-gray-300"></div>
                
                <form id="responseForm">
                    <input type="hidden" id="responseQuestionId">
                    
                    <div class="mb-4">
                        <label class="form-label" for="responseContent">Your Response</label>
                        <textarea id="responseContent" class="form-textarea" rows="4" placeholder="Type your response..." required></textarea>
                    </div>
                    
                    <div id="responseEmailInfo" class="mb-4 info-box">
                        <p>Notification will be sent to: <span id="responseEmailAddress">No email provided</span></p>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="button" class="btn-secondary mr-2" id="cancelResponse">Cancel</button>
                        <button type="submit" id="submitResponseBtn" class="btn-primary">Submit Response</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal for Adding Leadership Updates -->
        <div id="updateModal" class="modal">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Add Leadership Update</h2>
                
                <form id="updateForm">
                    <input type="hidden" id="updateId" value="">
                    <div class="mb-4">
                        <label class="form-label" for="updateTitle">Update Title</label>
                        <input type="text" id="updateTitle" class="form-input" placeholder="Title of your update" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label" for="updateContent">Update Content</label>
                        <textarea id="updateContent" class="form-textarea" rows="6" placeholder="Share your update with the team..." required></textarea>
                    </div>
                    
                    <div class="flex justify-end">
                        <button type="button" class="btn-secondary mr-2" id="cancelUpdate">Cancel</button>
                        <button type="submit" class="btn-primary" id="publishUpdateBtn">Publish Update</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal for Deleting Questions -->
        <div id="deleteModal" class="modal">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Delete Question</h2>
                <p class="mb-6">Are you sure you want to delete this question? This action cannot be undone.</p>
                
                <div id="deleteQuestionDetails" class="mb-4 pb-4 border-b border-gray-300 text-gray-600"></div>
                
                <input type="hidden" id="deleteQuestionId">
                
                <div class="flex justify-end mt-6">
                    <button type="button" class="btn-secondary mr-2" id="cancelDelete">Cancel</button>
                    <button type="button" class="btn-danger" id="confirmDelete">Delete Question</button>
                </div>
            </div>
        </div>

        <!-- Modal for Deleting Leadership Updates -->
        <div id="deleteUpdateModal" class="modal">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Delete Leadership Update</h2>
                <p class="mb-6">Are you sure you want to delete this leadership update? This action cannot be undone.</p>
                
                <div id="deleteUpdateDetails" class="mb-4 pb-4 border-b border-gray-300 text-gray-600"></div>
                
                <input type="hidden" id="deleteUpdateId">
                
                <div class="flex justify-end mt-6">
                    <button type="button" class="btn-secondary mr-2" id="cancelDeleteUpdate">Cancel</button>
                    <button type="button" class="btn-danger" id="confirmDeleteUpdate">Delete Update</button>
                </div>
            </div>
        </div>

        <!-- Email Preview Modal -->
        <div id="emailPreviewModal" class="modal">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Email Preview</h2>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">New Question Notification (to Admin)</h3>
                    <div class="email-preview">
                        <div class="email-preview-header">
                            <div>To: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e68c878b8395c8888389a6858e9489848f88958988c885898b">[email&#160;protected]</a></div>
                            <div>Subject: New Question Submitted - APAC Finance Leadership AMA</div>
                        </div>
                        <div class="mt-3">
                            <p>A new question has been submitted in the APAC Finance Leadership AMA portal:</p>
                            <p class="mt-2"><strong>Title:</strong> [Question Title]</p>
                            <p><strong>Topic:</strong> [Topic]</p>
                            <p><strong>Submitted by:</strong> [Name]</p>
                            <p class="mt-2"><strong>Question:</strong></p>
                            <p>[Question Content]</p>
                            <p class="mt-3">Please log in to the AMA portal to respond.</p>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Response Notification (to Employee)</h3>
                    <div class="email-preview">
                        <div class="email-preview-header">
                            <div>To: [Employee Email]</div>
                            <div>Subject: Your Question Has Been Answered - APAC Finance Leadership AMA</div>
                        </div>
                        <div class="mt-3">
                            <p>Your question in the APAC Finance Leadership AMA portal has received a response:</p>
                            <p class="mt-2"><strong>Your Question:</strong> [Question Title]</p>
                            <p class="mt-2"><strong>Response:</strong></p>
                            <p>[Response Content]</p>
                            <p class="mt-3">You can view the full response and other questions in the AMA portal.</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-end mt-4">
                    <button id="closeEmailPreview" class="btn-secondary">Close</button>
                </div>
            </div>
        </div>

        <!-- Firebase Connection Troubleshooting Modal -->
        <div id="firebaseTroubleshootModal" class="modal">
            <div class="modal-content">
                <h2 class="text-2xl font-bold mb-4">Database Connection Troubleshooting</h2>
                
                <div class="error-box mb-6">
                    <h4 class="font-bold mb-2"><i class="fas fa-exclamation-circle mr-2"></i>Connection Issues Detected</h4>
                    <p>There seems to be an issue with the Firebase database connection.</p>
                </div>
                
                <div class="mb-4">
                    <h3 class="text-lg font-semibold mb-2">Troubleshooting Steps</h3>
                    
                    <div class="mb-3">
                        <span class="step-number">1</span>
                        <span>Check your internet connection</span>
                    </div>
                    
                    <div class="mb-3">
                        <span class="step-number">2</span>
                        <span>Refresh the page to attempt reconnection</span>
                    </div>
                    
                    <div class="mb-3">
                        <span class="step-number">3</span>
                        <span>Verify your firewall isn't blocking database connections</span>
                    </div>
                    
                    <div class="mb-3">
                        <span class="step-number">4</span>
                        <span>Try using a different browser or network</span>
                    </div>
                </div>
                
                <div class="info-box mb-6">
                    <h4 class="font-bold mb-2"><i class="fas fa-info-circle mr-2"></i>Fallback Mode</h4>
                    <p>The application will operate in local mode until the connection is restored, but changes won't be synchronized across users.</p>
                </div>
                
                <div class="flex justify-end mt-4">
                    <button id="closeFirebaseTroubleshoot" class="btn-secondary">Close</button>
                    <button id="retryConnection" class="btn-primary ml-2">
                        <i class="fas fa-sync-alt mr-1"></i>Retry Connection
                    </button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="fixed bottom-4 right-4 px-4 py-2 rounded-lg bg-gray-800 text-white shadow-lg transform transition-transform duration-300 translate-y-20 opacity-0">
            <span id="toastMessage">Notification message</span>
        </div>

        <!-- Connection Status Indicator -->
        <div id="connectionStatus" class="connection-status status-connected">
            <i class="fas fa-database mr-1"></i> <span id="connectionStatusText">Connected</span>
        </div>

        <!-- Firebase Scripts -->
        <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="https://cdn.jsdelivr.net/npm/firebase@9.19.1/firebase-app-compat.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/firebase@9.19.1/firebase-database-compat.js"></script>

        <script>
            // ===== FIREBASE CONFIGURATION =====
            // IMPORTANT: Replace this configuration with your own Firebase project details
            // See the Firebase Setup Instructions in the Admin Panel for how to get these values
            const firebaseConfig = {
                apiKey: "AIzaSyB7ypS5JIfb4GPqMSImnR8bmKsISbp34Fw",
                authDomain: "apac-finance-ama-9c046.firebaseapp.com",
                databaseURL: "https://apac-finance-ama-9c046-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "apac-finance-ama-9c046",
                storageBucket: "apac-finance-ama-9c046.firebasestorage.app",
                messagingSenderId: "434345334275",
                appId: "1:434345334275:web:97e52537bd78322fcee036"
            };
            // ===== END FIREBASE CONFIGURATION =====

            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
            const database = firebase.database();

            // Global variables and state
            let questions = [];
            let leadershipUpdates = [];
            let isAdmin = false;
            const defaultAdminPassword = 'admin123';
            const adminEmail = 'james.neo@chrobinson.com';
            let useLocalStorage = false; // Will be set to true if Firebase is unavailable
            
            // DOM Elements
            const questionsContainer = document.getElementById('questionsContainer');
            const leadershipUpdatesContainer = document.getElementById('leadershipUpdatesContainer');
            const updatesContent = document.getElementById('updatesContent');
            const submitQuestionForm = document.getElementById('submitQuestionForm');
            const adminPanel = document.getElementById('adminPanel');
            const adminTabs = document.getElementById('adminTabs');
            const adminLoginBtn = document.getElementById('adminLoginBtn');
            const adminLogoutBtn = document.getElementById('adminLogoutBtn');
            const adminLoginModal = document.getElementById('adminLoginModal');
            const responseModal = document.getElementById('responseModal');
            const updateModal = document.getElementById('updateModal');
            const deleteModal = document.getElementById('deleteModal');
            const deleteUpdateModal = document.getElementById('deleteUpdateModal');
            const emailPreviewModal = document.getElementById('emailPreviewModal');
            const firebaseTroubleshootModal = document.getElementById('firebaseTroubleshootModal');
            const connectionStatus = document.getElementById('connectionStatus');
            const connectionStatusText = document.getElementById('connectionStatusText');
            const toast = document.getElementById('toast');
            
            // Initialize app on load
            document.addEventListener('DOMContentLoaded', () => {
                initializeApp();
                setupEventListeners();
                setupAccordion();
                monitorDatabaseConnection();
            });

            // App initialization
            function initializeApp() {
                checkDatabaseConnection();
                loadData();
                updateAdminUI();
            }

            // Check Firebase connection
            function checkDatabaseConnection() {
                const connectedRef = database.ref(".info/connected");
                connectedRef.on("value", (snap) => {
                    if (snap.val() === true) {
                        connectionStatus.className = "connection-status status-connected";
                        connectionStatusText.textContent = "Connected";
                        useLocalStorage = false;
                        
                        if (document.getElementById('databaseStatusBox')) {
                            document.getElementById('databaseStatusBox').className = "success-box mb-4";
                            document.getElementById('databaseStatusBox').innerHTML = `
                                <h4 class="font-bold mb-2"><i class="fas fa-check-circle mr-2"></i>Firebase Database Connected</h4>
                                <p>The real-time database is connected and working properly.</p>
                            `;
                        }
                    } else {
                        connectionStatus.className = "connection-status status-disconnected";
                        connectionStatusText.textContent = "Disconnected";
                        useLocalStorage = true;
                        
                        if (document.getElementById('databaseStatusBox')) {
                            document.getElementById('databaseStatusBox').className = "error-box mb-4";
                            document.getElementById('databaseStatusBox').innerHTML = `
                                <h4 class="font-bold mb-2"><i class="fas fa-exclamation-circle mr-2"></i>Firebase Database Disconnected</h4>
                                <p>Using local storage as a fallback. Changes won't be synchronized across users.</p>
                                <button id="retryConnectionFromAdmin" class="btn-primary mt-2">
                                    <i class="fas fa-sync-alt mr-1"></i>Retry Connection
                                </button>
                            `;
                            
                            document.getElementById('retryConnectionFromAdmin').addEventListener('click', retryDatabaseConnection);
                        }
                    }
                });
            }

            // Monitor Firebase connection for changes
            function monitorDatabaseConnection() {
                database.ref(".info/connected").on("value", (snap) => {
                    if (snap.val() === true && useLocalStorage === true) {
                        // Connection restored after being in local storage mode
                        useLocalStorage = false;
                        showToast("Database connection restored! Synchronizing data...", "success");
                        
                        // Sync local changes to Firebase if we have any
                        synchronizeLocalChanges();
                        
                        // Re-load data from Firebase
                        loadData();
                    }
                });
            }

            // Retry database connection
            function retryDatabaseConnection() {
                showToast("Attempting to reconnect to database...", "info");
                
                // Force a reconnection attempt
                database.goOnline();
                
                // Check connection status after a brief delay
                setTimeout(() => {
                    const connectedRef = database.ref(".info/connected");
                    connectedRef.once("value", (snap) => {
                        if (snap.val() === true) {
                            showToast("Successfully reconnected to database!", "success");
                            closeFirebaseTroubleshootModal();
                        } else {
                            showToast("Failed to reconnect to database. Using local storage.", "error");
                        }
                    });
                }, 2000);
            }

            // Synchronize any local changes to Firebase
            function synchronizeLocalChanges() {
                // If we have data in localStorage, sync it to Firebase
                const localQuestions = localStorage.getItem('amaQuestions');
                const localUpdates = localStorage.getItem('amaLeadershipUpdates');
                
                if (localQuestions) {
                    const localQuestionsArray = JSON.parse(localQuestions);
                    database.ref('questions').set(localQuestionsArray);
                }
                
                if (localUpdates) {
                    const localUpdatesArray = JSON.parse(localUpdates);
                    database.ref('leadershipUpdates').set(localUpdatesArray);
                }
            }

            // Load data from Firebase or localStorage as fallback
            function loadData() {
                if (!useLocalStorage) {
                    // Load from Firebase
                    loadQuestionsFromFirebase();
                    loadUpdatesFromFirebase();
                    
                    // Setup real-time listeners
                    setupRealTimeListeners();
                } else {
                    // Load from localStorage as fallback
                    loadDataFromLocalStorage();
                }
                
                // Always load admin settings from localStorage
                const savedAdminPassword = localStorage.getItem('amaAdminPassword');
                if (savedAdminPassword) {
                    adminPassword = savedAdminPassword;
                } else {
                    localStorage.setItem('amaAdminPassword', defaultAdminPassword);
                }
            }

            // Load questions from Firebase
            function loadQuestionsFromFirebase() {
                database.ref('questions').once('value')
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            questions = snapshot.val();
                            displayQuestions();
                        } else {
                            // No questions in database yet, create sample data
                            createSampleQuestions();
                        }
                    })
                    .catch((error) => {
                        console.error("Error loading questions from Firebase:", error);
                        loadDataFromLocalStorage();
                    });
            }

            // Load leadership updates from Firebase
            function loadUpdatesFromFirebase() {
                database.ref('leadershipUpdates').once('value')
                    .then((snapshot) => {
                        if (snapshot.exists()) {
                            leadershipUpdates = snapshot.val();
                            displayLeadershipUpdates();
                        } else {
                            // No updates in database yet, create sample data
                            createSampleUpdates();
                        }
                    })
                    .catch((error) => {
                        console.error("Error loading updates from Firebase:", error);
                        loadDataFromLocalStorage();
                    });
            }

            // Setup real-time listeners for Firebase data changes
            function setupRealTimeListeners() {
                // Listen for changes to questions
                database.ref('questions').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        questions = snapshot.val();
                        displayQuestions();
                    }
                });
                
                // Listen for changes to leadership updates
                database.ref('leadershipUpdates').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        leadershipUpdates = snapshot.val();
                        displayLeadershipUpdates();
                    }
                });
            }

            // Create sample questions if none exist
            function createSampleQuestions() {
                questions = [
                    {
                        id: 'q1',
                        title: 'When will the next salary review happen?',
                        content: 'I was wondering about the timeline for the next salary review cycle.',
                        topic: 'compensation',
                        submitter: 'Anonymous',
                        email: '',
                        date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                        upvotes: 12,
                        upvotedBy: [],
                        response: 'The next salary review will happen in April 2023. We will communicate the exact dates as we get closer to the review period.',
                        responseDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
                    },
                    {
                        id: 'q2',
                        title: 'Are there plans to expand our team in APAC?',
                        content: 'I\'ve noticed increased workload and was wondering if there are plans to hire more people in the Finance department.',
                        topic: 'strategy',
                        submitter: 'Jane Smith',
                        email: '',
                        date: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                        upvotes: 8,
                        upvotedBy: [],
                        response: '',
                        responseDate: ''
                    },
                    {
                        id: 'q3',
                        title: 'Can we get more information about the flexible benefits package?',
                        content: 'I would like to understand how we can best utilize the flexible benefits offered by the company.',
                        topic: 'benefits',
                        submitter: 'Anonymous',
                        email: '',
                        date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                        upvotes: 15,
                        upvotedBy: [],
                        response: 'Great question! We will be hosting an information session about flexible benefits on June 15th. Details will be sent via email next week.',
                        responseDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ];
                
                // Save to Firebase
                database.ref('questions').set(questions)
                    .then(() => {
                        displayQuestions();
                    })
                    .catch((error) => {
                        console.error("Error creating sample questions:", error);
                        useLocalStorage = true;
                        saveQuestionsToLocalStorage();
                        displayQuestions();
                    });
            }

            // Create sample leadership updates if none exist
            function createSampleUpdates() {
                leadershipUpdates = [
                    {
                        id: 'u1',
                        title: 'Q2 Financial Results',
                        content: 'We are pleased to announce that our Q2 financial results exceeded expectations. The Finance team has done an exceptional job managing costs while supporting business growth. \n\nThank you for your continued dedication and hard work.',
                        date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString()
                    }
                ];
                
                // Save to Firebase
                database.ref('leadershipUpdates').set(leadershipUpdates)
                    .then(() => {
                        displayLeadershipUpdates();
                    })
                    .catch((error) => {
                        console.error("Error creating sample updates:", error);
                        useLocalStorage = true;
                        saveUpdatesToLocalStorage();
                        displayLeadershipUpdates();
                    });
            }

            // Load data from localStorage (fallback)
            function loadDataFromLocalStorage() {
                try {
                    // Load questions
                    const savedQuestions = localStorage.getItem('amaQuestions');
                    if (savedQuestions) {
                        questions = JSON.parse(savedQuestions);
                        displayQuestions();
                    } else {
                        // Sample questions for first-time users
                        questions = [
                            {
                                id: 'q1',
                                title: 'When will the next salary review happen?',
                                content: 'I was wondering about the timeline for the next salary review cycle.',
                                topic: 'compensation',
                                submitter: 'Anonymous',
                                email: '',
                                date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                                upvotes: 12,
                                upvotedBy: [],
                                response: 'The next salary review will happen in April 2023. We will communicate the exact dates as we get closer to the review period.',
                                responseDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
                            },
                            {
                                id: 'q2',
                                title: 'Are there plans to expand our team in APAC?',
                                content: 'I\'ve noticed increased workload and was wondering if there are plans to hire more people in the Finance department.',
                                topic: 'strategy',
                                submitter: 'Jane Smith',
                                email: '',
                                date: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),
                                upvotes: 8,
                                upvotedBy: [],
                                response: '',
                                responseDate: ''
                            },
                            {
                                id: 'q3',
                                title: 'Can we get more information about the flexible benefits package?',
                                content: 'I would like to understand how we can best utilize the flexible benefits offered by the company.',
                                topic: 'benefits',
                                submitter: 'Anonymous',
                                email: '',
                                date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                                upvotes: 15,
                                upvotedBy: [],
                                response: 'Great question! We will be hosting an information session about flexible benefits on June 15th. Details will be sent via email next week.',
                                responseDate: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString()
                            }
                        ];
                        saveQuestionsToLocalStorage();
                        displayQuestions();
                    }

                    // Load leadership updates
                    const savedUpdates = localStorage.getItem('amaLeadershipUpdates');
                    if (savedUpdates) {
                        leadershipUpdates = JSON.parse(savedUpdates);
                        displayLeadershipUpdates();
                    } else {
                        // Sample leadership update for first-time users
                        leadershipUpdates = [
                            {
                                id: 'u1',
                                title: 'Q2 Financial Results',
                                content: 'We are pleased to announce that our Q2 financial results exceeded expectations. The Finance team has done an exceptional job managing costs while supporting business growth. \n\nThank you for your continued dedication and hard work.',
                                date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString()
                            }
                        ];
                        saveUpdatesToLocalStorage();
                        displayLeadershipUpdates();
                    }
                } catch (error) {
                    console.error('Error loading data from localStorage:', error);
                    showToast('Error loading data. Starting with empty state.', 'error');
                    questions = [];
                    leadershipUpdates = [];
                }
            }

            // Save questions to database
            function saveQuestions() {
                if (!useLocalStorage) {
                    // Save to Firebase
                    database.ref('questions').set(questions)
                        .catch((error) => {
                            console.error("Error saving questions to Firebase:", error);
                            useLocalStorage = true;
                            saveQuestionsToLocalStorage();
                            showToast("Failed to save to database. Using local storage instead.", "warning");
                        });
                } else {
                    // Save to localStorage
                    saveQuestionsToLocalStorage();
                }
            }

            // Save leadership updates to database
            function saveUpdates() {
                if (!useLocalStorage) {
                    // Save to Firebase
                    database.ref('leadershipUpdates').set(leadershipUpdates)
                        .catch((error) => {
                            console.error("Error saving updates to Firebase:", error);
                            useLocalStorage = true;
                            saveUpdatesToLocalStorage();
                            showToast("Failed to save to database. Using local storage instead.", "warning");
                        });
                } else {
                    // Save to localStorage
                    saveUpdatesToLocalStorage();
                }
            }

            // Save questions to localStorage (fallback)
            function saveQuestionsToLocalStorage() {
                try {
                    localStorage.setItem('amaQuestions', JSON.stringify(questions));
                } catch (error) {
                    console.error('Error saving questions to localStorage:', error);
                    showToast('Error saving question data.', 'error');
                }
            }

            // Save leadership updates to localStorage (fallback)
            function saveUpdatesToLocalStorage() {
                try {
                    localStorage.setItem('amaLeadershipUpdates', JSON.stringify(leadershipUpdates));
                } catch (error) {
                    console.error('Error saving updates to localStorage:', error);
                    showToast('Error saving leadership updates.', 'error');
                }
            }

            // Display questions in the container
            function displayQuestions() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const topicFilter = document.getElementById('topicFilter').value;
                const sortFilter = document.getElementById('sortFilter').value;
                
                // Filter questions based on search and topic
                let filteredQuestions = questions.filter(question => {
                    const matchesSearch = 
                        question.title.toLowerCase().includes(searchTerm) || 
                        question.content.toLowerCase().includes(searchTerm);
                    
                    const matchesTopic = topicFilter === 'all' || question.topic === topicFilter;
                    
                    return matchesSearch && matchesTopic;
                });
                
                // Sort questions
                if (sortFilter === 'popular') {
                    filteredQuestions.sort((a, b) => b.upvotes - a.upvotes);
                } else {
                    filteredQuestions.sort((a, b) => new Date(b.date) - new Date(a.date));
                }
                
                // Render the HTML
                if (filteredQuestions.length === 0) {
                    questionsContainer.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-search text-4xl mb-4 text-gray-500"></i>
                            <p class="text-gray-600">No questions found. Try adjusting your filters or be the first to ask!</p>
                        </div>
                    `;
                    return;
                }
                
                questionsContainer.innerHTML = filteredQuestions.map(question => {
                    const topicClass = `badge-${question.topic}`;
                    const topicText = {
                        'benefits': 'Employee Benefits',
                        'compensation': 'Compensation',
                        'strategy': 'Strategy & Direction',
                        'others': 'Others'
                    }[question.topic] || question.topic;
                    
                    const date = new Date(question.date);
                    const formattedDate = `${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                    
                    const adminControls = isAdmin ? `
                        <div class="flex space-x-2 mt-2">
                            ${!question.response ? `
                                <button class="btn-primary respond-btn" data-id="${question.id}">
                                    <i class="fas fa-reply mr-1"></i> Respond
                                </button>
                            ` : `
                                <button class="btn-secondary respond-btn" data-id="${question.id}">
                                    <i class="fas fa-edit mr-1"></i> Edit Response
                                </button>
                            `}
                            <button class="btn-danger delete-btn" data-id="${question.id}">
                                <i class="fas fa-trash-alt mr-1"></i> Delete
                            </button>
                        </div>
                    ` : '';
                    
                    return `
                    <div class="card question-card p-4 mb-4" data-id="${question.id}">
                        <div class="flex items-start">
                            <div class="mr-4 text-center">
                                <button class="upvote-btn flex flex-col items-center ${question.upvotedBy.includes(getClientId()) ? 'upvoted' : ''}" data-id="${question.id}">
                                    <i class="fas fa-chevron-up text-xl"></i>
                                    <span class="text-lg font-semibold">${question.upvotes}</span>
                                </button>
                            </div>
                            
                            <div class="flex-1">
                                <h3 class="text-xl font-bold mb-2">${escapeHtml(question.title)}</h3>
                                
                                <div class="flex flex-wrap items-center mb-3">
                                    <span class="badge ${topicClass} mr-2">${topicText}</span>
                                    <span class="text-gray-600 text-sm">
                                        Asked by ${escapeHtml(question.submitter)} on ${formattedDate}
                                    </span>
                                </div>
                                
                                <div class="mb-4 whitespace-pre-line">${escapeHtml(question.content)}</div>
                                
                                ${question.response ? `
                                <div class="mt-4 border-t border-gray-300 pt-4">
                                    <h4 class="font-semibold text-green-600 mb-2">Response:</h4>
                                    <div class="whitespace-pre-line">${escapeHtml(question.response)}</div>
                                    <div class="text-gray-600 text-sm mt-2">
                                        Answered on ${new Date(question.responseDate).toLocaleDateString()}
                                    </div>
                                </div>
                                ${isAdmin ? adminControls : ''}
                                ` : (isAdmin ? adminControls : `
                                <div class="mt-4 text-gray-600 italic">
                                    <i class="fas fa-hourglass-half mr-1"></i> Awaiting response
                                </div>
                                `)}
                            </div>
                        </div>
                    </div>
                    `;
                }).join('');
                
                // Add event listeners to upvote buttons
                document.querySelectorAll('.upvote-btn').forEach(button => {
                    button.addEventListener('click', handleUpvote);
                });
                
                // Add event listeners to admin buttons (for admin)
                if (isAdmin) {
                    document.querySelectorAll('.respond-btn').forEach(button => {
                        button.addEventListener('click', openResponseModal);
                    });
                    
                    document.querySelectorAll('.delete-btn').forEach(button => {
                        button.addEventListener('click', openDeleteModal);
                    });
                }

                // Update pending questions in the admin panel if admin is logged in
                if (isAdmin) {
                    updatePendingQuestions();
                }
            }

            // Display leadership updates
            function displayLeadershipUpdates() {
                if (leadershipUpdates.length === 0) {
                    updatesContent.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-info-circle text-4xl mb-4 text-gray-500"></i>
                            <p class="text-gray-600">No updates available yet.</p>
                        </div>
                    `;
                    return;
                }
                
                // Sort updates by date (newest first)
                const sortedUpdates = [...leadershipUpdates].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                updatesContent.innerHTML = sortedUpdates.map(update => {
                    const date = new Date(update.date);
                    const formattedDate = `${date.toLocaleDateString()} at ${date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
                    
                    const adminButtons = isAdmin ? `
                        <div class="flex mt-3 space-x-2">
                            <button class="btn-secondary edit-update-btn" data-id="${update.id}">
                                <i class="fas fa-edit mr-1"></i> Edit
                            </button>
                            <button class="btn-danger delete-update-btn" data-id="${update.id}">
                                <i class="fas fa-trash-alt mr-1"></i> Delete
                            </button>
                        </div>
                    ` : '';
                    
                    return `
                    <div class="update-card" data-id="${update.id}">
                        <div class="timestamp">Posted on ${formattedDate}</div>
                        <h3 class="text-xl font-bold mb-2">${escapeHtml(update.title)}</h3>
                        <div class="update-content">${escapeHtml(update.content)}</div>
                        ${adminButtons}
                    </div>
                    `;
                }).join('');
                
                // Add event listeners to admin buttons (for admin)
                if (isAdmin) {
                    document.querySelectorAll('.edit-update-btn').forEach(button => {
                        button.addEventListener('click', function(e) {
                            const updateId = e.currentTarget.getAttribute('data-id');
                            openEditUpdateModal(updateId);
                        });
                    });
                    
                    document.querySelectorAll('.delete-update-btn').forEach(button => {
                        button.addEventListener('click', function(e) {
                            const updateId = e.currentTarget.getAttribute('data-id');
                            openDeleteUpdateModal(updateId);
                        });
                    });
                }
            }

            // Update pending questions in admin panel
            function updatePendingQuestions() {
                const pendingContainer = document.getElementById('pendingQuestionsContainer');
                if (!pendingContainer) return;
                
                const pendingQuestions = questions.filter(q => !q.response);
                
                if (pendingQuestions.length === 0) {
                    pendingContainer.innerHTML = `<p class="text-gray-600">No pending questions.</p>`;
                    return;
                }
                
                pendingContainer.innerHTML = pendingQuestions.map(question => {
                    const date = new Date(question.date);
                    const formattedDate = `${date.toLocaleDateString()}`;
                    
                    return `
                    <div class="card p-3 admin-panel-card" data-id="${question.id}">
                        <h4 class="font-bold">${escapeHtml(question.title)}</h4>
                        <div class="text-sm text-gray-600 mb-2">
                            From: ${escapeHtml(question.submitter)} | Date: ${formattedDate} | Topic: ${getTopicName(question.topic)}
                        </div>
                        <button class="btn-primary respond-btn mt-1" data-id="${question.id}">
                            <i class="fas fa-reply mr-1"></i> Respond
                        </button>
                    </div>
                    `;
                }).join('');
                
                // Add event listeners to respond buttons
                pendingContainer.querySelectorAll('.respond-btn').forEach(button => {
                    button.addEventListener('click', openResponseModal);
                });
            }

            // Handle upvoting a question
            function handleUpvote(e) {
                const questionId = e.currentTarget.getAttribute('data-id');
                const clientId = getClientId();
                
                const questionIndex = questions.findIndex(q => q.id === questionId);
                if (questionIndex === -1) return;
                
                const question = questions[questionIndex];
                
                // Initialize upvotedBy array if it doesn't exist
                if (!question.upvotedBy) {
                    question.upvotedBy = [];
                }
                
                // Toggle upvote
                if (question.upvotedBy.includes(clientId)) {
                    question.upvotes--;
                    question.upvotedBy = question.upvotedBy.filter(id => id !== clientId);
                    e.currentTarget.classList.remove('upvoted');
                } else {
                    question.upvotes++;
                    question.upvotedBy.push(clientId);
                    e.currentTarget.classList.add('upvoted');
                }
                
                // Update the display
                e.currentTarget.querySelector('span').textContent = question.upvotes;
                
                // Save to database
                saveQuestions();
            }

            // Get a unique client ID for tracking upvotes
            function getClientId() {
                let clientId = localStorage.getItem('amaClientId');
                if (!clientId) {
                    clientId = 'client_' + Math.random().toString(36).substr(2, 9);
                    localStorage.setItem('amaClientId', clientId);
                }
                return clientId;
            }

            // Submit a new question with AJAX to avoid redirects
            function submitQuestion(e) {
                e.preventDefault();
                
                // Disable the submit button and show loading state
                const submitButton = document.getElementById('submitQuestionBtn');
                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = `<div class="loading-spinner mr-2"></div> Submitting...`;
                
                const title = document.getElementById('questionTitle').value.trim();
                const content = document.getElementById('questionContent').value.trim();
                const topic = document.getElementById('questionTopic').value;
                const submitter = document.getElementById('submitterName').value.trim() || 'Anonymous';
                const email = document.getElementById('submitterEmail').value.trim();
                
                if (!title || !content || !topic) {
                    showToast('Please fill in all required fields.', 'error');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    return;
                }
                
                const newQuestion = {
                    id: 'q' + Date.now(),
                    title,
                    content,
                    topic,
                    submitter,
                    email,
                    date: new Date().toISOString(),
                    upvotes: 0,
                    upvotedBy: [],
                    response: '',
                    responseDate: ''
                };
                
                // Add to questions array
                questions.unshift(newQuestion);
                
                // Save to database
                saveQuestions();
                
                // Prepare form data for email
                const topicText = getTopicName(topic);
                
                // Update email status
                updateEmailStatus("Sending email notification to admin...");
                
                // Create FormData object for the AJAX request
                const formData = new FormData();
                formData.append('_subject', 'New Question Submitted - APAC Finance Leadership AMA');
                formData.append('_template', 'table');
                formData.append('_captcha', 'false');
                formData.append('Question Title', title);
                formData.append('Topic', topicText);
                formData.append('Submitted By', submitter);
                formData.append('Question Details', content);
                
                // Use fetch API to send the form data without redirects
                fetch('https://formsubmit.co/ajax/' + adminEmail, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateEmailStatus("Email notification sent to admin successfully");
                        showToast('Your question has been submitted and admin has been notified', 'success');
                    } else {
                        throw new Error('Form submission failed');
                    }
                })
                .catch(error => {
                    console.error("Failed to send email notification:", error);
                    updateEmailStatus("Failed to send email notification, but your question has been saved", true);
                    showToast('Question submitted, but admin notification failed', 'warning');
                })
                .finally(() => {
                    // Reset form and button state
                    document.getElementById('questionForm').reset();
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    
                    // Switch to questions tab
                    showTab('tabAllQuestions');
                    
                    // Update display
                    displayQuestions();
                });
            }

            // Submit a response to a question with AJAX to avoid redirects
            function submitResponse(e) {
                e.preventDefault();
                
                // Disable the submit button and show loading state
                const submitButton = document.getElementById('submitResponseBtn');
                const originalButtonText = submitButton.innerHTML;
                submitButton.disabled = true;
                submitButton.innerHTML = `<div class="loading-spinner mr-2"></div> Submitting...`;
                
                const questionId = document.getElementById('responseQuestionId').value;
                const response = document.getElementById('responseContent').value.trim();
                
                if (!response) {
                    showToast('Please enter a response.', 'error');
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    return;
                }
                
                const questionIndex = questions.findIndex(q => q.id === questionId);
                if (questionIndex === -1) {
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    return;
                }
                
                const question = questions[questionIndex];
                const isNewResponse = !question.response;
                
                question.response = response;
                question.responseDate = new Date().toISOString();
                
                // Save to database
                saveQuestions();
                
                // If the question submitter provided an email, send notification
                if (question.email) {
                    // Update status
                    updateEmailStatus("Sending notification to employee...");
                    
                    // Create FormData object for the AJAX request
                    const formData = new FormData();
                    formData.append('_subject', 'Your Question Has Been Answered - APAC Finance Leadership AMA');
                    formData.append('_template', 'table');
                    formData.append('_captcha', 'false');
                    formData.append('Your Question', question.title);
                    formData.append('Response', response);
                    
                    // Use fetch API to send the form data without redirects
                    fetch('https://formsubmit.co/ajax/' + question.email, {
                        method: 'POST',
                        body: formData,
                        headers: {
                            'Accept': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            updateEmailStatus("Email notification sent to employee successfully");
                            showToast('Response submitted and employee has been notified', 'success');
                        } else {
                            throw new Error('Form submission failed');
                        }
                    })
                    .catch(error => {
                        console.error("Failed to send employee notification:", error);
                        updateEmailStatus("Failed to send employee notification, but response has been saved", true);
                        showToast('Response submitted, but employee notification failed', 'warning');
                    })
                    .finally(() => {
                        // Reset button state
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                        
                        // Close modal
                        closeResponseModal();
                        
                        // Update display
                        displayQuestions();
                    });
                } else {
                    // No email to notify, just show success
                    submitButton.disabled = false;
                    submitButton.innerHTML = originalButtonText;
                    closeResponseModal();
                    showToast(isNewResponse ? 'Response submitted successfully!' : 'Response updated successfully!', 'success');
                    displayQuestions();
                }
            }

            // Submit a new leadership update or edit existing one
            function submitUpdate(e) {
                e.preventDefault();
                
                const title = document.getElementById('updateTitle').value.trim();
                const content = document.getElementById('updateContent').value.trim();
                const updateId = document.getElementById('updateId').value;
                
                if (!title || !content) {
                    showToast('Please fill in all fields.', 'error');
                    return;
                }
                
                // Check if we're editing or adding
                if (updateId) {
                    // Edit existing update
                    const updateIndex = leadershipUpdates.findIndex(u => u.id === updateId);
                    if (updateIndex !== -1) {
                        // Preserve the original date
                        const originalDate = leadershipUpdates[updateIndex].date;
                        leadershipUpdates[updateIndex] = {
                            id: updateId,
                            title,
                            content,
                            date: originalDate
                        };
                        showToast('Leadership update edited successfully!', 'success');
                    }
                } else {
                    // Add new update
                    const newUpdate = {
                        id: 'u' + Date.now(),
                        title,
                        content,
                        date: new Date().toISOString()
                    };
                    leadershipUpdates.unshift(newUpdate);
                    showToast('Leadership update published successfully!', 'success');
                }
                
                // Save to database
                saveUpdates();
                
                // Reset form and close modal
                document.getElementById('updateForm').reset();
                document.getElementById('updateId').value = '';
                document.getElementById('publishUpdateBtn').textContent = 'Publish Update';
                closeUpdateModal();
                
                // Update display
                displayLeadershipUpdates();
            }

            // Delete a question
            function deleteQuestion() {
                const questionId = document.getElementById('deleteQuestionId').value;
                
                questions = questions.filter(q => q.id !== questionId);
                
                // Save to database
                saveQuestions();
                
                // Close modal
                closeDeleteModal();
                
                // Show success message
                showToast('Question deleted successfully.', 'success');
                
                // Update display
                displayQuestions();
            }

            // Delete a leadership update
            function deleteUpdate() {
                const updateId = document.getElementById('deleteUpdateId').value;
                
                leadershipUpdates = leadershipUpdates.filter(u => u.id !== updateId);
                
                // Save to database
                saveUpdates();
                
                // Close modal
                closeDeleteUpdateModal();
                
                // Show success message
                showToast('Leadership update deleted successfully.', 'success');
                
                // Update display
                displayLeadershipUpdates();
            }

            // Test the email system with AJAX to avoid redirects
            function testEmailSystem() {
                updateEmailStatus("Testing email system...");
                
                // Create FormData object for the AJAX request
                const formData = new FormData();
                formData.append('_subject', 'APAC Finance AMA - Email System Test');
                formData.append('_template', 'table');
                formData.append('_captcha', 'false');
                formData.append('Message', 'This is a test email to verify that the notification system is working correctly. If you received this, the email system is functioning properly.');
                
                // Use fetch API to send the form data without redirects
                fetch('https://formsubmit.co/ajax/' + adminEmail, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateEmailStatus("Test email sent successfully");
                        showToast('Test email sent successfully!', 'success');
                    } else {
                        throw new Error('Form submission failed');
                    }
                })
                .catch(error => {
                    console.error("Test email failed:", error);
                    updateEmailStatus("Test email failed: " + error.message, true);
                    showToast('Test email failed', 'error');
                });
            }

            // Update the email status indicator
            function updateEmailStatus(status, isError = false) {
                const statusElement = document.getElementById('emailStatus');
                const indicatorElement = document.getElementById('emailStatusIndicator');
                
                if (!statusElement || !indicatorElement) return;
                
                statusElement.textContent = status;
                
                if (isError) {
                    indicatorElement.className = 'error-box';
                    indicatorElement.innerHTML = `<p><i class="fas fa-exclamation-circle mr-2"></i>Email system status: <span id="emailStatus">${status}</span></p>`;
                } else {
                    indicatorElement.className = 'info-box';
                    indicatorElement.innerHTML = `<p><i class="fas fa-info-circle mr-2"></i>Email system status: <span id="emailStatus">${status}</span></p>`;
                }
            }

            // Helper function to get topic name from value
            function getTopicName(topicValue) {
                const topicMap = {
                    'benefits': 'Employee Benefits',
                    'compensation': 'Compensation',
                    'strategy': 'Strategy & Direction',
                    'others': 'Others'
                };
                return topicMap[topicValue] || topicValue;
            }

            // Setup accordion functionality
            function setupAccordion() {
                document.querySelectorAll('.accordion-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const content = header.nextElementSibling;
                        const icon = header.querySelector('i');
                        
                        // Toggle content visibility
                        content.classList.toggle('hidden');
                        
                        // Toggle icon
                        if (content.classList.contains('hidden')) {
                            icon.className = 'fas fa-chevron-down';
                        } else {
                            icon.className = 'fas fa-chevron-up';
                        }
                    });
                });
            }

            // Tab navigation
            function showTab(tabId) {
                // Hide all content sections
                submitQuestionForm.style.display = 'none';
                adminPanel.style.display = 'none';
                questionsContainer.style.display = 'none';
                leadershipUpdatesContainer.style.display = 'none';
                document.getElementById('searchFilterBar').style.display = 'none';
                
                // Remove active class from all tabs
                document.querySelectorAll('.tab-active').forEach(tab => {
                    tab.classList.remove('tab-active');
                });
                
                // Show appropriate content and mark tab as active
                if (tabId === 'tabSubmitQuestion') {
                    submitQuestionForm.style.display = 'block';
                    document.getElementById(tabId).classList.add('tab-active');
                } else if (tabId === 'tabLeadershipUpdates') {
                    leadershipUpdatesContainer.style.display = 'block';
                    document.getElementById(tabId).classList.add('tab-active');
                    displayLeadershipUpdates();
                } else if (tabId === 'tabAdminPanel' && isAdmin) {
                    adminPanel.style.display = 'block';
                    document.getElementById(tabId).classList.add('tab-active');
                    updatePendingQuestions();
                } else {
                    // Default to all questions
                    questionsContainer.style.display = 'block';
                    document.getElementById('searchFilterBar').style.display = 'flex';
                    document.getElementById('tabAllQuestions').classList.add('tab-active');
                    displayQuestions();
                }
            }

            // Admin login
            function handleAdminLogin(e) {
                e.preventDefault();
                
                const password = document.getElementById('adminLoginPassword').value;
                const savedPassword = localStorage.getItem('amaAdminPassword') || defaultAdminPassword;
                
                if (password === savedPassword) {
                    isAdmin = true;
                    adminTabs.style.display = 'block';
                    adminLoginBtn.style.display = 'none';
                    adminLogoutBtn.style.display = 'inline-flex';
                    closeAdminLoginModal();
                    showToast('Admin login successful!', 'success');
                    updateAdminUI();
                } else {
                    showToast('Incorrect password. Please try again.', 'error');
                }
            }

            // Admin logout
            function handleAdminLogout() {
                isAdmin = false;
                adminLoginBtn.style.display = 'inline-flex';
                adminLogoutBtn.style.display = 'none';
                showToast('Logged out successfully', 'success');
                updateAdminUI();
                showTab('tabAllQuestions');
            }

            // Update admin password
            function updateAdminPassword() {
                const newPassword = document.getElementById('adminPassword').value.trim();
                
                if (!newPassword) {
                    showToast('Please enter a new password.', 'error');
                    return;
                }
                
                localStorage.setItem('amaAdminPassword', newPassword);
                document.getElementById('adminPassword').value = '';
                showToast('Admin password updated successfully!', 'success');
            }

            // Update admin UI elements
            function updateAdminUI() {
                if (isAdmin) {
                    adminTabs.style.display = 'block';
                    adminLoginBtn.style.display = 'none';
                    adminLogoutBtn.style.display = 'inline-flex';
                    document.querySelectorAll('.admin-controls').forEach(el => {
                        el.style.display = 'block';
                    });
                } else {
                    adminTabs.style.display = 'none';
                    adminLoginBtn.style.display = 'inline-flex';
                    adminLogoutBtn.style.display = 'none';
                    document.querySelectorAll('.admin-controls').forEach(el => {
                        el.style.display = 'none';
                    });
                }
                
                // Refresh the current tab view
                if (document.getElementById('tabAllQuestions').classList.contains('tab-active')) {
                    displayQuestions();
                } else if (document.getElementById('tabLeadershipUpdates').classList.contains('tab-active')) {
                    displayLeadershipUpdates();
                }
            }

            // Open the update modal for editing
            function openEditUpdateModal(updateId) {
                const update = leadershipUpdates.find(u => u.id === updateId);
                if (!update) return;
                
                document.getElementById('updateId').value = updateId;
                document.getElementById('updateTitle').value = update.title;
                document.getElementById('updateContent').value = update.content;
                document.getElementById('publishUpdateBtn').textContent = 'Update';
                
                updateModal.style.display = 'flex';
                document.getElementById('updateTitle').focus();
            }

            // Open the modal for deleting a leadership update
            function openDeleteUpdateModal(updateId) {
                const update = leadershipUpdates.find(u => u.id === updateId);
                if (!update) return;
                
                document.getElementById('deleteUpdateId').value = updateId;
                
                document.getElementById('deleteUpdateDetails').innerHTML = `
                    <h3 class="text-lg font-bold mb-1">${escapeHtml(update.title)}</h3>
                    <div class="text-sm">Posted on ${new Date(update.date).toLocaleDateString()}</div>
                `;
                
                deleteUpdateModal.style.display = 'flex';
            }

            // Open the Firebase troubleshooting modal
            function openFirebaseTroubleshootModal() {
                firebaseTroubleshootModal.style.display = 'flex';
            }

            // Close the Firebase troubleshooting modal
            function closeFirebaseTroubleshootModal() {
                firebaseTroubleshootModal.style.display = 'none';
            }

            // Modal functions
            function openAdminLoginModal() {
                adminLoginModal.style.display = 'flex';
                document.getElementById('adminLoginPassword').value = '';
                document.getElementById('adminLoginPassword').focus();
            }

            function closeAdminLoginModal() {
                adminLoginModal.style.display = 'none';
            }

            function openResponseModal(e) {
                const questionId = e.currentTarget.getAttribute('data-id');
                const question = questions.find(q => q.id === questionId);
                
                if (!question) return;
                
                document.getElementById('responseQuestionId').value = questionId;
                document.getElementById('responseContent').value = question.response || '';
                
                const topicText = getTopicName(question.topic);
                
                document.getElementById('responseQuestionDetails').innerHTML = `
                    <h3 class="text-xl font-bold mb-2">${escapeHtml(question.title)}</h3>
                    <div class="flex items-center mb-2">
                        <span class="badge badge-${question.topic} mr-2">${topicText}</span>
                        <span class="text-gray-600 text-sm">
                            Asked by ${escapeHtml(question.submitter)}
                        </span>
                    </div>
                    <div class="whitespace-pre-line">${escapeHtml(question.content)}</div>
                `;
                
                // Update email info
                const emailInfoElement = document.getElementById('responseEmailInfo');
                const emailAddressElement = document.getElementById('responseEmailAddress');
                
                if (question.email) {
                    emailInfoElement.className = 'mb-4 info-box';
                    emailAddressElement.textContent = question.email;
                } else {
                    emailInfoElement.className = 'mb-4 warning-box';
                    emailAddressElement.textContent = 'No email provided (no notification will be sent)';
                }
                
                responseModal.style.display = 'flex';
                document.getElementById('responseContent').focus();
            }

            function closeResponseModal() {
                responseModal.style.display = 'none';
            }

            function openUpdateModal() {
                document.getElementById('updateForm').reset();
                document.getElementById('updateId').value = '';
                document.getElementById('publishUpdateBtn').textContent = 'Publish Update';
                updateModal.style.display = 'flex';
                document.getElementById('updateTitle').focus();
            }

            function closeUpdateModal() {
                updateModal.style.display = 'none';
            }

            function openDeleteModal(e) {
                const questionId = e.currentTarget.getAttribute('data-id');
                const question = questions.find(q => q.id === questionId);
                
                if (!question) return;
                
                document.getElementById('deleteQuestionId').value = questionId;
                
                document.getElementById('deleteQuestionDetails').innerHTML = `
                    <h3 class="text-lg font-bold mb-1">${escapeHtml(question.title)}</h3>
                    <div class="text-sm">Asked by ${escapeHtml(question.submitter)}</div>
                `;
                
                deleteModal.style.display = 'flex';
            }

            function closeDeleteModal() {
                deleteModal.style.display = 'none';
            }

            function closeDeleteUpdateModal() {
                deleteUpdateModal.style.display = 'none';
            }

            function openEmailPreviewModal() {
                emailPreviewModal.style.display = 'flex';
            }

            function closeEmailPreviewModal() {
                emailPreviewModal.style.display = 'none';
            }

            // Toast notification
            function showToast(message, type = 'info') {
                const toastElement = document.getElementById('toast');
                const messageElement = document.getElementById('toastMessage');
                
                messageElement.textContent = message;
                
                // Set color based on type
                if (type === 'error') {
                    toastElement.classList.add('bg-red-800');
                    toastElement.classList.remove('bg-green-800', 'bg-gray-800', 'bg-yellow-800');
                } else if (type === 'success') {
                    toastElement.classList.add('bg-green-800');
                    toastElement.classList.remove('bg-red-800', 'bg-gray-800', 'bg-yellow-800');
                } else if (type === 'warning') {
                    toastElement.classList.add('bg-yellow-800');
                    toastElement.classList.remove('bg-red-800', 'bg-green-800', 'bg-gray-800');
                } else {
                    toastElement.classList.add('bg-gray-800');
                    toastElement.classList.remove('bg-red-800', 'bg-green-800', 'bg-yellow-800');
                }
                
                // Show toast
                toastElement.classList.remove('translate-y-20', 'opacity-0');
                
                // Hide after 3 seconds
                setTimeout(() => {
                    toastElement.classList.add('translate-y-20', 'opacity-0');
                }, 3000);
            }

            // HTML escape function for security
            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            // Create and download the manual email links
            function setupManualEmailLinks() {
                // Admin notification email
                document.getElementById('manualAdminEmailLink').addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const subject = "New Question Submitted - APAC Finance Leadership AMA";
                    const body = "A new question has been submitted in the APAC Finance Leadership AMA portal.\n\nPlease log in to the AMA portal to view and respond.";
                    
                    window.open(`mailto:${adminEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
                });
                
                // Employee notification email
                document.getElementById('manualEmployeeEmailLink').addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Show an input dialog for the email address
                    const employeeEmail = prompt("Enter the employee's email address:");
                    
                    if (!employeeEmail) return;
                    
                    const subject = "Your APAC Finance Leadership AMA Question Has Been Answered";
                    const body = "Your question in the APAC Finance Leadership AMA portal has received a response.\n\nPlease visit the AMA portal to view the answer.";
                    
                    window.open(`mailto:${employeeEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`, '_blank');
                });
            }

            // Set up event listeners
            function setupEventListeners() {
                // Tab navigation
                document.getElementById('tabAllQuestions').addEventListener('click', () => showTab('tabAllQuestions'));
                document.getElementById('tabLeadershipUpdates').addEventListener('click', () => showTab('tabLeadershipUpdates'));
                document.getElementById('tabSubmitQuestion').addEventListener('click', () => showTab('tabSubmitQuestion'));
                document.getElementById('tabAdminPanel')?.addEventListener('click', () => showTab('tabAdminPanel'));
                
                // Form submissions
                document.getElementById('questionForm').addEventListener('submit', submitQuestion);
                document.getElementById('responseForm').addEventListener('submit', submitResponse);
                document.getElementById('updateForm').addEventListener('submit', submitUpdate);
                document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
                
                // Admin functions
                document.getElementById('adminLoginBtn').addEventListener('click', openAdminLoginModal);
                document.getElementById('adminLogoutBtn').addEventListener('click', handleAdminLogout);
                document.getElementById('cancelAdminLogin').addEventListener('click', closeAdminLoginModal);
                document.getElementById('cancelResponse').addEventListener('click', closeResponseModal);
                document.getElementById('addUpdateBtn').addEventListener('click', openUpdateModal);
                document.getElementById('cancelUpdate').addEventListener('click', closeUpdateModal);
                document.getElementById('cancelDelete').addEventListener('click', closeDeleteModal);
                document.getElementById('confirmDelete').addEventListener('click', deleteQuestion);
                document.getElementById('cancelDeleteUpdate').addEventListener('click', closeDeleteUpdateModal);
                document.getElementById('confirmDeleteUpdate').addEventListener('click', deleteUpdate);
                document.getElementById('saveAdminPassword').addEventListener('click', updateAdminPassword);
                
                // Email system
                document.getElementById('testEmailBtn').addEventListener('click', testEmailSystem);
                document.getElementById('viewEmailPreviewBtn').addEventListener('click', openEmailPreviewModal);
                document.getElementById('closeEmailPreview').addEventListener('click', closeEmailPreviewModal);
                
                // Firebase troubleshooting
                document.getElementById('closeFirebaseTroubleshoot')?.addEventListener('click', closeFirebaseTroubleshootModal);
                document.getElementById('retryConnection')?.addEventListener('click', retryDatabaseConnection);
                
                // Connection status indicator
                connectionStatus.addEventListener('click', function() {
                    if (connectionStatusText.textContent === "Disconnected") {
                        openFirebaseTroubleshootModal();
                    }
                });
                
                // Setup manual email links
                setupManualEmailLinks();
                
                // Search and filter
                document.getElementById('searchInput').addEventListener('input', displayQuestions);
                document.getElementById('topicFilter').addEventListener('change', displayQuestions);
                document.getElementById('sortFilter').addEventListener('change', displayQuestions);
                
                // Close modals when clicking outside
                window.addEventListener('click', (e) => {
                    if (e.target === adminLoginModal) {
                        closeAdminLoginModal();
                    }
                    if (e.target === responseModal) {
                        closeResponseModal();
                    }
                    if (e.target === updateModal) {
                        closeUpdateModal();
                    }
                    if (e.target === deleteModal) {
                        closeDeleteModal();
                    }
                    if (e.target === deleteUpdateModal) {
                        closeDeleteUpdateModal();
                    }
                    if (e.target === emailPreviewModal) {
                        closeEmailPreviewModal();
                    }
                    if (e.target === firebaseTroubleshootModal) {
                        closeFirebaseTroubleshootModal();
                    }
                });
            }

            // Show All Questions tab by default
            showTab('tabAllQuestions');
        </script>
    </div>
</body>
</html>
